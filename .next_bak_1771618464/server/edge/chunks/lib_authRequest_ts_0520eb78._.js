(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["chunks/lib_authRequest_ts_0520eb78._.js",1775,e=>{"use strict";e.s(["getRequestAuthUser",()=>_],1775);var r=e.i(30887),t=e.i(11083),i=e.i(43795);async function a(e){await (0,i.ensureAuthUsersTable)();let r=(await (0,i.runD1Query)("SELECT is_active, force_logout_after FROM auth_users WHERE email = ? LIMIT 1",[e.email.trim().toLowerCase()]))[0];if(!r)return!0;if(!r.is_active)return!1;if(!r.force_logout_after)return!0;if(!e.sessionIssuedAt)return!1;let t=Date.parse(e.sessionIssuedAt),a=Date.parse(r.force_logout_after);return!(Number.isNaN(t)||Number.isNaN(a))&&t>a}var n=e.i(47986);e.i(43820);var s=e.i(635);e.i(81527);var o=e.i(68644),u=e.i(66401),c=e.i(18904),l=e.i(99690),d=e.i(10824),f=e.i(92879),h=e.i(20173),g=e.i(40436),p=e.i(5809);e.i(49783);let b=new WeakMap;function m(e){let r=b.get(e);if(r)return r;let t=Promise.resolve(e);return b.set(e,t),Object.defineProperties(t,{[Symbol.iterator]:{value:e[Symbol.iterator]?e[Symbol.iterator].bind(e):E.bind(e)},size:{get:()=>e.size},get:{value:e.get.bind(e)},getAll:{value:e.getAll.bind(e)},has:{value:e.has.bind(e)},set:{value:e.set.bind(e)},delete:{value:e.delete.bind(e)},clear:{value:"function"==typeof e.clear?e.clear.bind(e):y.bind(e,t)},toString:{value:e.toString.bind(e)}}),t}function E(){return this.getAll().map(e=>[e.name,e]).values()}function y(e){for(let e of this.getAll())this.delete(e.name);return e}async function _(){let e=await function e(){let r="cookies",t=o.workAsyncStorage.getStore(),i=c.workUnitAsyncStorage.getStore();if(t){if(i&&"after"===i.phase&&!(0,g.isRequestAPICallableInsideAfter)())throw Object.defineProperty(Error(`Route ${t.route} used "cookies" inside "after(...)". This is not supported. If you need this data inside an "after" callback, use "cookies" outside of the callback. See more info here: https://nextjs.org/docs/canary/app/api-reference/functions/after`),"__NEXT_ERROR_CODE",{value:"E88",enumerable:!1,configurable:!0});if(t.forceStatic)return m(n.RequestCookiesAdapter.seal(new s.RequestCookies(new Headers({}))));if(t.dynamicShouldError)throw Object.defineProperty(new d.StaticGenBailoutError(`Route ${t.route} with \`dynamic = "error"\` couldn't be rendered statically because it used \`cookies\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering`),"__NEXT_ERROR_CODE",{value:"E549",enumerable:!1,configurable:!0});if(i)switch(i.type){case"cache":let o=Object.defineProperty(Error(`Route ${t.route} used "cookies" inside "use cache". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/messages/next-request-in-use-cache`),"__NEXT_ERROR_CODE",{value:"E398",enumerable:!1,configurable:!0});throw Error.captureStackTrace(o,e),t.invalidDynamicUsageError??=o,o;case"unstable-cache":throw Object.defineProperty(Error(`Route ${t.route} used "cookies" inside a function cached with "unstable_cache(...)". Accessing Dynamic data sources inside a cache scope is not supported. If you need this data inside a cached function use "cookies" outside of the cached function and pass the required dynamic data in as an argument. See more info here: https://nextjs.org/docs/app/api-reference/functions/unstable_cache`),"__NEXT_ERROR_CODE",{value:"E157",enumerable:!1,configurable:!0});case"prerender":var a=t,h=i;let u=b.get(h);if(u)return u;let c=(0,f.makeHangingPromise)(h.renderSignal,a.route,"`cookies()`");return b.set(h,c),c;case"prerender-client":let E="`cookies`";throw Object.defineProperty(new p.InvariantError(`${E} must not be used within a client component. Next.js should be preventing ${E} from being included in client components statically, but did not in this case.`),"__NEXT_ERROR_CODE",{value:"E693",enumerable:!1,configurable:!0});case"prerender-ppr":return(0,l.postponeWithTracking)(t.route,r,i.dynamicTracking);case"prerender-legacy":return(0,l.throwToInterruptStaticGeneration)(r,t,i);case"prerender-runtime":return(0,l.delayUntilRuntimeStage)(i,function(e){let r=b.get(e);if(r)return r;let t=Promise.resolve(e);return b.set(e,t),t}(i.cookies));case"private-cache":return m(i.cookies);case"request":return(0,l.trackDynamicDataInDynamicRender)(i),m((0,n.areCookiesMutableInCurrentPhase)(i)?i.userspaceMutableCookies:i.cookies)}}(0,u.throwForMissingRequestStore)(r)}(),i=e.get(r.AUTH_COOKIE_NAME)?.value,h=(0,r.decodeAuthUser)(i);if(!h)return null;try{let[e,r]=await Promise.all([(0,t.findAuthUserByEmail)(h.email),a({email:h.email,sessionIssuedAt:h.sessionIssuedAt})]);if(!r)return null;if(e)return{...h,role:e.role}}catch{}return h}(0,h.createDedupedByCallsiteServerErrorLoggerDev)(function(e,r){let t=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${t}used ${r}. \`cookies()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E223",enumerable:!1,configurable:!0})}),e.i(55468),new WeakMap,(0,h.createDedupedByCallsiteServerErrorLoggerDev)(function(e,r){let t=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${t}used ${r}. \`headers()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E277",enumerable:!1,configurable:!0})}),e.i(25249),new WeakMap,(0,h.createDedupedByCallsiteServerErrorLoggerDev)(function(e,r){let t=e?`Route "${e}" `:"This route ";return Object.defineProperty(Error(`${t}used ${r}. \`draftMode()\` should be awaited before using its value. Learn more: https://nextjs.org/docs/messages/sync-dynamic-apis`),"__NEXT_ERROR_CODE",{value:"E377",enumerable:!1,configurable:!0})})}]);

//# sourceMappingURL=lib_authRequest_ts_0520eb78._.js.map