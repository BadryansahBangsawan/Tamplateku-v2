(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["chunks/[root-of-the-server]__e89cbb4a._.js",84256,e=>{"use strict";async function t(){return"_ENTRIES"in globalThis&&_ENTRIES.middleware_instrumentation&&await _ENTRIES.middleware_instrumentation}e.s(["edgeInstrumentationOnRequestError",()=>r,"ensureInstrumentationRegistered",()=>a,"getEdgeInstrumentationModule",()=>t]);let n=null;async function s(){if("phase-production-build"===process.env.NEXT_PHASE)return;n||(n=t());let e=await n;if(null==e?void 0:e.register)try{await e.register()}catch(e){throw e.message=`An error occurred while loading instrumentation hook: ${e.message}`,e}}async function r(...e){let n=await t();try{var s;await (null==n||null==(s=n.onRequestError)?void 0:s.call(n,...e))}catch(e){console.error("Error in instrumentation.onRequestError:",e)}}let i=null;function a(){return i||(i=s()),i}function o(e){return`The edge runtime does not support Node.js '${e}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}process!==e.g.process&&(process.env=e.g.process.env,e.g.process=process);try{Object.defineProperty(globalThis,"__import_unsupported",{value:function(e){let t=new Proxy(function(){},{get(t,n){if("then"===n)return{};throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})},construct(){throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})},apply(n,s,r){if("function"==typeof r[0])return r[0](t);throw Object.defineProperty(Error(o(e)),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}});return new Proxy({},{get:()=>t})},enumerable:!1,configurable:!1})}catch{}a()},34080,35171,e=>{"use strict";e.s(["dynamicAccessAsyncStorageInstance",()=>t],34080);let t=(0,e.i(42871).createAsyncLocalStorage)();e.s(["dynamicAccessAsyncStorage",()=>t],35171)},70438,e=>{"use strict";e.s(["actionAsyncStorage",()=>t.actionAsyncStorageInstance]);var t=e.i(89610)},78500,(e,t,n)=>{t.exports=e.x("node:async_hooks",()=>require("node:async_hooks"))},51615,(e,t,n)=>{t.exports=e.x("node:buffer",()=>require("node:buffer"))},42871,e=>{"use strict";e.s(["createAsyncLocalStorage",()=>r]);let t=Object.defineProperty(Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available"),"__NEXT_ERROR_CODE",{value:"E504",enumerable:!1,configurable:!0});class n{disable(){throw t}getStore(){}run(){throw t}exit(){throw t}enterWith(){throw t}static bind(e){return e}}let s="undefined"!=typeof globalThis&&globalThis.AsyncLocalStorage;function r(){return s?new s:new n}},13477,e=>{"use strict";e.s(["workAsyncStorageInstance",()=>t]);let t=(0,e.i(42871).createAsyncLocalStorage)()},68644,e=>{"use strict";e.s(["workAsyncStorage",()=>t.workAsyncStorageInstance]);var t=e.i(13477)},85021,e=>{"use strict";e.s(["workUnitAsyncStorageInstance",()=>t]);let t=(0,e.i(42871).createAsyncLocalStorage)()},18904,e=>{"use strict";e.s(["workUnitAsyncStorage",()=>t.workUnitAsyncStorageInstance]);var t=e.i(85021)},89610,e=>{"use strict";e.s(["actionAsyncStorageInstance",()=>t]);let t=(0,e.i(42871).createAsyncLocalStorage)()},34953,85105,e=>{"use strict";e.s(["afterTaskAsyncStorageInstance",()=>t],34953);let t=(0,e.i(42871).createAsyncLocalStorage)();e.s(["afterTaskAsyncStorage",()=>t],85105)},69568,e=>{"use strict";let t;e.s(["trackPendingChunkLoad",()=>i,"trackPendingImport",()=>a,"trackPendingModules",()=>o],69568);class n extends Error{constructor(e,t){super("Invariant: "+(e.endsWith(".")?e:e+".")+" This is a bug in Next.js.",t),this.name="InvariantError"}}class s{constructor(){throw this.count=0,this.earlyListeners=[],this.listeners=[],this.tickPending=!1,this.taskPending=!1,this.subscribedSignals=null,Object.defineProperty(new n("CacheSignal cannot be used in the edge runtime, because `cacheComponents` does not support it."),"__NEXT_ERROR_CODE",{value:"E685",enumerable:!1,configurable:!0})}noMorePendingCaches(){this.tickPending||(this.tickPending=!0,process.nextTick(()=>{if(this.tickPending=!1,0===this.count){for(let e=0;e<this.earlyListeners.length;e++)this.earlyListeners[e]();this.earlyListeners.length=0}})),this.taskPending||(this.taskPending=!0,setTimeout(()=>{if(this.taskPending=!1,0===this.count){for(let e=0;e<this.listeners.length;e++)this.listeners[e]();this.listeners.length=0}},0))}inputReady(){return new Promise(e=>{this.earlyListeners.push(e),0===this.count&&this.noMorePendingCaches()})}cacheReady(){return new Promise(e=>{this.listeners.push(e),0===this.count&&this.noMorePendingCaches()})}beginRead(){if(this.count++,null!==this.subscribedSignals)for(let e of this.subscribedSignals)e.beginRead()}endRead(){if(0===this.count)throw Object.defineProperty(new n("CacheSignal got more endRead() calls than beginRead() calls"),"__NEXT_ERROR_CODE",{value:"E678",enumerable:!1,configurable:!0});if(this.count--,0===this.count&&this.noMorePendingCaches(),null!==this.subscribedSignals)for(let e of this.subscribedSignals)e.endRead()}trackRead(e){this.beginRead();let t=this.endRead.bind(this);return e.then(t,t),e}subscribeToReads(e){if(e===this)throw Object.defineProperty(new n("A CacheSignal cannot subscribe to itself"),"__NEXT_ERROR_CODE",{value:"E679",enumerable:!1,configurable:!0});null===this.subscribedSignals&&(this.subscribedSignals=new Set),this.subscribedSignals.add(e);for(let t=0;t<this.count;t++)e.beginRead();return this.unsubscribeFromReads.bind(this,e)}unsubscribeFromReads(e){this.subscribedSignals&&this.subscribedSignals.delete(e)}}function r(){return t||(t=new s),t}function i(e){r().trackRead(e)}function a(e){let t=r();if(null!==e&&"object"==typeof e&&"then"in e&&"function"==typeof e.then){let n=Promise.resolve(e);t.trackRead(n)}}function o(e){let t=r().subscribeToReads(e);e.cacheReady().then(t)}},43795,e=>{"use strict";e.s(["ensureAuthUsersTable",()=>r,"runD1Query",()=>n]);let t=null;async function n(e,t=[]){let{accountId:s,databaseId:r,apiToken:i}=function(){let e=process.env.CLOUDFLARE_ACCOUNT_ID,t=process.env.CLOUDFLARE_D1_DATABASE_ID,n=process.env.CLOUDFLARE_API_TOKEN;if(!e||!t||!n)throw Error("Missing Cloudflare D1 env vars: CLOUDFLARE_ACCOUNT_ID, CLOUDFLARE_D1_DATABASE_ID, CLOUDFLARE_API_TOKEN");return{accountId:e,databaseId:t,apiToken:n}}(),a=`https://api.cloudflare.com/client/v4/accounts/${s}/d1/database/${r}/query`,o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`},body:JSON.stringify({sql:e,params:t}),cache:"no-store"});if(!o.ok){let e=await o.text();throw Error(`D1 query failed (${o.status}): ${e}`)}let c=await o.json();if(!c.success)throw Error(c.errors?.[0]?.message??"Unknown D1 error");return c.result?.[0]?.results??[]}async function s(){await n(`
    CREATE TABLE IF NOT EXISTS auth_users (
      id TEXT PRIMARY KEY,
      name TEXT NOT NULL,
      email TEXT NOT NULL UNIQUE,
      password_hash TEXT NOT NULL,
      role TEXT NOT NULL DEFAULT 'USER',
      is_active INTEGER NOT NULL DEFAULT 1,
      must_change_password INTEGER NOT NULL DEFAULT 0,
      force_logout_after TEXT,
      last_login_at TEXT,
      email_verified_at TEXT,
      notes TEXT,
      created_at TEXT NOT NULL,
      updated_at TEXT NOT NULL
    );
  `);let e=await n("PRAGMA table_info(auth_users)");e.some(e=>"email_verified_at"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN email_verified_at TEXT"),e.some(e=>"role"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN role TEXT NOT NULL DEFAULT 'USER'"),e.some(e=>"is_active"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN is_active INTEGER NOT NULL DEFAULT 1"),e.some(e=>"must_change_password"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN must_change_password INTEGER NOT NULL DEFAULT 0"),e.some(e=>"force_logout_after"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN force_logout_after TEXT"),e.some(e=>"last_login_at"===e.name)||await n("ALTER TABLE auth_users ADD COLUMN last_login_at TEXT")}async function r(){t||(t=s().catch(e=>{throw t=null,e})),await t}},95422,e=>{"use strict";function t(e){let t=e.headers.get("cf-connecting-ip");if(t&&t.trim().length>0)return t.trim().slice(0,64);let n=e.headers.get("x-forwarded-for");return n&&n.trim().length>0?n.split(",")[0].trim().slice(0,64):"unknown"}function n(e){return(e.headers.get("user-agent")??"unknown").slice(0,512)}e.s(["getRequestIp",()=>t,"getRequestUserAgent",()=>n])},40022,(e,t,n)=>{self._ENTRIES||={};let s=Promise.resolve().then(()=>e.i(22284));s.catch(()=>{}),self._ENTRIES["middleware_app/api/otp/request/route"]=new Proxy(s,{get(e,t){if("then"===t)return(t,n)=>e.then(t,n);let n=(...n)=>e.then(e=>(0,e[t])(...n));return n.then=(n,s)=>e.then(e=>e[t]).then(n,s),n}})}]);

//# sourceMappingURL=%5Broot-of-the-server%5D__e89cbb4a._.js.map